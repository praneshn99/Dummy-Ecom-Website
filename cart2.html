<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<!-- Include Bootstrap CSS -->
<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css">
<title>Cart Page</title>
<style>
  .cart-item {
    border: 1px solid #ddd;
    padding: 10px;
    margin-bottom: 20px;
  }
  .cart-total {
    border-top: 2px solid #ddd;
    padding-top: 10px;
    margin-top: 20px;
    font-size: 1.5em;
    font-weight: bold;
  }
  .quantity-controls {
    display: flex;
    align-items: center;
  }
  .quantity-controls button {
    margin: 0 5px;
  }
</style>
</head>
<body>

<div class="container mt-5">
  <h1 class="mb-4">Your Cart</h1>
  <div id="cart-items"></div>
</div>

<!-- Modal -->
<div class="modal fade" id="removeProductModal" tabindex="-1" role="dialog" aria-labelledby="removeProductModalLabel" aria-hidden="true">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="removeProductModalLabel">Product Removed</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">Ã—</span>
        </button>
      </div>
      <div class="modal-body">
        Product Removed from the cart.
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div>

<!-- Purchase Button -->
<button type="button" class="purchase-button" data-toggle="modal" data-target="#confirmationModal">Purchase</button>

<div class="modal fade" id="confirmationModal" tabindex="-1" role="dialog" aria-labelledby="confirmationModalLabel" aria-hidden="true">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="confirmationModalLabel">Confirm Purchase</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        Are you sure you want to proceed with the purchase?
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
        <button type="button" id="purchaseNowButton" class="btn btn-primary">Purchase Now</button>
      </div>
    </div>
  </div>
</div>

<style>
.purchase-button {
  background-color: #3498db;  /* Blue background color */
  color: #fff;                 /* White text color */
  font-weight: bold;           /* Bold text */
  text-align: center;          /* Center-aligned text */
  border: none;                /* Remove border */
  border-radius: 5px;          /* Slightly rounded edges */
  padding: 10px 20px;          /* Adjust padding for desired button size */
  cursor: pointer;            /* Indicate interactivity */
  transition: background-color 0.2s ease-in-out, transform 0.1s ease-in-out;  /* Hover and press animations */
}

.purchase-button:hover {
  background-color: #2980b9;   /* Slight color change on hover */
}

.purchase-button:active {
  transform: scale(0.98);      /* Press animation (scale down slightly) */
}
</style>

<script>
document.getElementById('purchaseNowButton').addEventListener('click', function() {
  window.location.href = "purchase.html";
});
</script>

<script>
function getCookie(name) {
  let cookieArr = document.cookie.split(";");
  for(let i = 0; i < cookieArr.length; i++) {
    let cookiePair = cookieArr[i].split("=");
    if(name == cookiePair[0].trim()) {
      return decodeURIComponent(cookiePair[1]);
    }
  }
  return null;
}

function setCookie(name, value, days) {
  let expires = "";
  if (days) {
    let date = new Date();
    date.setTime(date.getTime() + (days*24*60*60*1000));
    expires = "; expires=" + date.toUTCString();
  }
  document.cookie = name + "=" + value + expires + "; path=/";
}

function updateCartDisplay() {
  let cartData = getCookie('cart');
  let cartItems = cartData ? JSON.parse(cartData) : {};
  let cartContainer = document.getElementById('cart-items');
  cartContainer.innerHTML = ''; // Clear the cart container
  let totalAmount = 0;

  for(let id in cartItems) {
    let item = cartItems[id];
    let itemAmount = item.price * item.quantity;
    totalAmount += itemAmount;
    let itemDiv = document.createElement('div');
    itemDiv.classList.add('cart-item', 'p-3', 'mb-3', 'border', 'rounded');
    itemDiv.innerHTML = `
      <h3 class="h5">${item.name}</h3>
      <div class="quantity-controls">
        <button onclick="changeQuantity('${id}', -1)" class="btn btn-danger">-</button>
        <span class="mx-2">${item.quantity}</span>
        <button onclick="changeQuantity('${id}', 1)" class="btn btn-success">+</button>
      </div>
      <p>Amount: <span class="font-weight-bold">$${itemAmount.toFixed(2)}</span></p>
    `;
    cartContainer.appendChild(itemDiv);
  }

  let totalDiv = document.createElement('div');
  totalDiv.classList.add('cart-total', 'pt-3', 'mt-3', 'border-top');
  totalDiv.innerHTML = `<h2 class="h4">Total Amount: <span class="font-weight-bold">$${totalAmount.toFixed(2)}</span></h2>`;
  cartContainer.appendChild(totalDiv);
}

function changeQuantity(productId, change) {
  let cartData = getCookie('cart');
  let cartItems = cartData ? JSON.parse(cartData) : {};

  if(cartItems[productId]) {
    cartItems[productId].quantity += change;
    if(cartItems[productId].quantity <= 0) {
      delete cartItems[productId];
      $('#removeProductModal').modal('show'); // Show the modal
    }
    setCookie('cart', JSON.stringify(cartItems), 7);
    updateCartDisplay(); // Update the cart display
  }
}

// Call updateCartDisplay on page load
window.onload = updateCartDisplay;
</script>

<!-- Include Bootstrap JS and its dependencies -->
<script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"></script>

</body>
</html>
